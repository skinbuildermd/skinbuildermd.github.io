<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://baguettecss.github.io/v1/v1.css">
    <link rel="shortcut icon" href="./img/logo/logo-spwp.svg" type="image/x-icon">

    <title>SkinBuilder</title>
</head>
<body>
    <div class="headline -l">
        <div class="logo">
            <a href="./">
                <img src="./img/logo/logo-spwp1.svg" alt="">
            </a>
        </div>
    </div>
    <div class="main">
        <div class="in">
            <div class="pre-skin">
                <div class="adds-skins -br">
                    <div id="golova" class="installed"></div>
                    <div id="verh" class="installed"></div>
                    <div id="nogi" class="installed"></div>
                    <div id="obuv" class="installed"></div>
                </div>
            </div>
            <div class="skin -br">
                <div class="pix-skin">
                    <img id="skin-sel" src="/img/air.png" alt="">
                </div>
                <div class="skompil">
                    <label class="change-btn -br" for="inputImage">
                        <span id="labelText" title="Выберите файл...">Выберите файл</span>
                        <input type="file" id="inputImage" accept="image/*">
                    </label>
                    <div style="margin-left: 1rem;" class="skompil-btn -br">
                        <p id="compileButton" title="Скомпилировать Ваш скин" onclick="compileSkin()">Скомпилировать</p>
                    </div>
                </div>
            </div>
            <div class="at">
                <div class="clothes -br">
                    <div class="c hj"></div>
                    <div class="c verh selected" onclick="changeClothes('verh')"><img class="verh" src="./img/models/verh/verh_1.png"></div>
                    <div class="c nogi" onclick="changeClothes('nogi')"><img src="./img/models/nogi/nogi_1.png"></div>
                    <div class="c obuv" onclick="changeClothes('obuv')"></div>
                </div>
                <div class="all-cloat -br">
                    <div class="all-cloat-scroll">
                        <div class="w" onclick="changeVerhImage(this)">
                            <img src="./img/models/verh/verh_1.png" alt="">
                        </div>
                        <div class="w" onclick="changeVerhImage(this)">
                            <img src="./img/models/verh/verh_2.png" alt="">
                        </div>
                        <div class="w" onclick="changeVerhImage(this)">
                            <img src="./img/models/verh/verh_3.png" alt="">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        function displaySelectedFile(event) {
            var file = event.target.files[0];
            var reader = new FileReader();

            reader.onload = function(event) {
                var image = document.getElementById("skin-sel");
                image.setAttribute('src', event.target.result);
            };

            reader.readAsDataURL(file);
        }

        function changeVerhImage(element) {
            var imageSrc = element.querySelector('img').getAttribute('src');
            var verhElement = document.getElementById('verh');
            verhElement.innerHTML = '<img class="verh" src="' + imageSrc + '">';
        }

        function changeClothes(clothesType) {
            var images = document.querySelectorAll('.w img');
            var selectedNogi = document.querySelector('.nogi.selected');
            var wElement = document.querySelector('.w');
          
            if (clothesType === 'nogi') {
              images.forEach(function(image) {
                var src = image.getAttribute('src');
                var newSrc = src.replace('/verh/', '/nogi/').replace('verh_', 'nogi_');
                image.setAttribute('src', newSrc);
              });
          
              if (selectedNogi && wElement) {
                if (selectedNogi.classList.contains('selected')) {
                  wElement.setAttribute('id', 'nogi-sel');
                } else {
                  wElement.removeAttribute('id');
                }
              }
            } else if (clothesType === 'verh') {
              images.forEach(function(image) {
                var src = image.getAttribute('src');
                var newSrc = src.replace('/nogi/', '/verh/').replace('nogi_', 'verh_');
                image.setAttribute('src', newSrc);
              });
          
              wElement.removeAttribute('id');
            }
          }          

        function compileSkin() {
            var selectedFile = document.getElementById('inputImage').files[0];
            var clothesElement = document.getElementById('verh');
            var clothesImage = clothesElement.querySelector('img');
            var clothesSrc = clothesImage.getAttribute('src');
          
            var canvas = document.createElement('canvas');
            var ctx = canvas.getContext('2d');
            var img = new Image();
          
            img.onload = function () {
              canvas.width = img.width;
              canvas.height = img.height;
              ctx.drawImage(img, 0, 0);
          
              var installedImage = document.querySelector('#verh.installed img');
              if (installedImage) {
                var imageSrc = installedImage.src.replace('models', 'skins');
                var fileName = imageSrc.split('/').pop();
                clothesSrc = './img/skins/verh/' + fileName;
              }
          
              var clothesImg = new Image();
              clothesImg.onload = function () {
                ctx.drawImage(clothesImg, 0, 0, img.width, img.height);
          
                var downloadLink = document.createElement('a');
                downloadLink.href = canvas.toDataURL();
                downloadLink.download = 'compiled_skin.png';
                downloadLink.click();
              };
              clothesImg.src = clothesSrc;
            };
            img.src = URL.createObjectURL(selectedFile);
          }          

        document.getElementById('inputImage').addEventListener('change', displaySelectedFile);


        document.getElementById('inputImage').addEventListener('change', function(event) {
            var file = event.target.files[0];
            var reader = new FileReader();
            reader.onload = function(event) {
                var img = new Image();
                img.src = event.target.result;
                // You can now use the img variable to access the user imported image
            };
            reader.readAsDataURL(file);
        });  


        //Переключение между категориями
        document.addEventListener('DOMContentLoaded', function() {
            var nogiElement = document.querySelector('.nogi');
            var verhElement = document.querySelector('.verh');
        
            nogiElement.addEventListener('click', function() {
                nogiElement.classList.add('selected');
                verhElement.classList.remove('selected');
            });
        
            verhElement.addEventListener('click', function() {
                verhElement.classList.add('selected');
                nogiElement.classList.remove('selected');
            });
        });


              
    </script>
</body>
</html>